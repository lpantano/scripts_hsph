---
output:
    knitrBootstrap::bootstrap_document:
        theme: readable
        highlight: zenburn
        theme.chooser: TRUE
        highlight.chooser: TRUE
    html_document:
        toc: true
        highlight: zenburn
---


```{r custom}
source("~/repos/myRfunctions/transactions.R")
dn <- "glasgow_cluster/wgs_10_samples"
files_path = "~/repos/pipelines/glasgow_cluster/x10_WGS_2/"
knitr::opts_chunk$set(tidy=TRUE, highlight=TRUE, dev="png",
                      cache=FALSE, highlight=TRUE, autodep=TRUE, warning=FALSE, error=FALSE,
                      eval=TRUE, fig.width= 9,
                      message=FALSE, prompt=TRUE, comment='', fig.cap='', bootstrap.show.code=FALSE)
setwd(files_path)
```


```{r render,eval=FALSE,cache=FALSE}
#render_2_drop("~/repos/pipelines/glasgow_cluster/create_stats_report.Rmd",dn)
```

```{r functions}
get_figures = function(p, pattern){
    list.files( p, pattern = pattern )
}
```

```{r report}
library("Nozzle.R1")
report <- ""
report  <-  newCustomReport( "10 samples at 30x WGS" );
```


# CPU stats

```{r cpu,results='asis'}
section = newSection("CPU",class="results")

for ( fn in get_figures(files_path,"cpu") ){
    name = strsplit(fn,"_")[[1]][1]
    #print( paste0(name,":![",name,"](",get_report_links( paste0(files_path,fn) ),")" ) )
    fn = get_report_links( paste0(files_path,fn) )
    print(fn)
    fg = newFigure( fn, exportId=fn,fileHighRes=fn,name);
    section  =  addTo( section, fg )
}

report  =  addTo(report,section);
```


# MEM stats

```{r mem,results='asis'}
section = newSection("Memory",class="results")

for ( fn in get_figures(files_path,"memory") ){
    name = strsplit(fn,"_")[[1]][1]
    #print( paste0("[",name,"](",get_report_links( paste0(files_path,fn) ),")" ) )
    fn = get_report_links( paste0(files_path,fn) )
    fg = newFigure( fn, exportId=fn,fileHighRes=fn,name);
    section  =  addTo( section, fg )

}
report  =  addTo(report,section);

```

# sda disk stats

```{r disk,results='asis'}
section = newSection("SDA Disk",class="results")

for ( fn in get_figures(files_path,"disk") ){
    name = strsplit(fn,"_")[[1]][1]
    #print( paste0("[",name,"](",get_report_links( paste0(files_path,fn) ),")" ) )
    fn = get_report_links( paste0(files_path,fn) )
    fg = newFigure( fn, exportId=fn,fileHighRes=fn,name);
    section  =  addTo( section, fg )

}
report  =  addTo(report,section);

```


# lustre disk stats

Adding the screenshot from the web app to compare.

```{r lustre,results='asis'}
section = newSection("lustre Disk",class="results")

for ( fn in get_figures(files_path,"lustre") ){
    if (grepl("png",fn)){
        name = strsplit(fn,"_")[[1]][1]
        #print( paste0("[",name,"](",get_report_links( paste0(files_path,fn) ),")" ) )
        fn = get_report_links( paste0(files_path,fn) )
        fg = newFigure( fn, exportId=fn,fileHighRes=fn,name);
        section  =  addTo( section, fg )
    }
}
report  =  addTo(report,section);

```



# network bits stats

```{r net,results='asis'}
section = newSection("Network",class="results")

for ( fn in get_figures(files_path,"net_bytes") ){
    name = strsplit(fn,"_")[[1]][1]
    #print( paste0("[",name,"](",get_report_links( paste0(files_path,fn) ),")" ) )
    fn = get_report_links( paste0(files_path,fn) )
    fg = newFigure( fn, exportId=fn,fileHighRes=fn,name);
    section  =  addTo( section, fg )

}
report  =  addTo(report,section);

writeReport( report, filename=paste0(files_path,"report"))

copy_2_drop(paste0(files_path,"report.html"),dn)

```



